<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Sankey Diagram • sfo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Create Sankey Diagram">
<meta property="og:description" content="sfo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v1_intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/v2_analyzing_sfo.html">Analyzing SFO Passengers</a>
    </li>
    <li>
      <a href="../articles/v3_analyzing_landing.html">Analyzing SFO Landing</a>
    </li>
    <li>
      <a href="../articles/v3_sankey.html">Create Sankey Diagram</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="v3_sankey_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="v3_sankey_files/plotly-binding-4.10.1/plotly.js"></script><script src="v3_sankey_files/typedarray-0.1/typedarray.min.js"></script><script src="v3_sankey_files/jquery-3.5.1/jquery.min.js"></script><link href="v3_sankey_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="v3_sankey_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="v3_sankey_files/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="v3_sankey_files/plotly-main-2.11.1/plotly-latest.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Create Sankey Diagram</h1>
            
      
      
      <div class="hidden name"><code>v3_sankey.Rmd</code></div>

    </div>

    
    
<p>A Sankey diagram is a common method for visualizing a numeric variable’s distribution across multiple categorical variables. The <code>sankey_ly</code> function is a wrapper for the <a href="https://plotly.com/r/sankey-diagram/" class="external-link">plotly Sankey</a> functionality. It enables a fast creation of a Sankey diagram without the need for data transformation and node mapping.</p>
<p>The function has the following arguments:</p>
<ul>
<li>
<code>x</code> - aggregate data.frame object must have at least two categorical variables and one numeric variable</li>
<li>
<code>cat_cols</code> - a vector of at least two categorical columns names</li>
<li>
<code>num_col</code> - a single numeric column name</li>
<li>
<code>title</code> - optional, enables to set title for the plot</li>
</ul>
<div class="section level3">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h3>
<p>Let’s see some use cases of the function with the <code>sfo_passengers</code> dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sfo</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sfo_passengers"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sfo_passengers</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    50730 obs. of  12 variables:</span>
<span class="co">#&gt;  $ activity_period            : int  202212 202212 202212 202212 202212 202212 202212 202212 202212 202212 ...</span>
<span class="co">#&gt;  $ operating_airline          : chr  "EVA Airways" "EVA Airways" "Emirates" "Emirates" ...</span>
<span class="co">#&gt;  $ operating_airline_iata_code: chr  "BR" "BR" "EK" "EK" ...</span>
<span class="co">#&gt;  $ published_airline          : chr  "EVA Airways" "EVA Airways" "Emirates" "Emirates" ...</span>
<span class="co">#&gt;  $ published_airline_iata_code: chr  "BR" "BR" "EK" "EK" ...</span>
<span class="co">#&gt;  $ geo_summary                : chr  "International" "International" "International" "International" ...</span>
<span class="co">#&gt;  $ geo_region                 : chr  "Asia" "Asia" "Middle East" "Middle East" ...</span>
<span class="co">#&gt;  $ activity_type_code         : chr  "Deplaned" "Enplaned" "Deplaned" "Enplaned" ...</span>
<span class="co">#&gt;  $ price_category_code        : chr  "Other" "Other" "Other" "Other" ...</span>
<span class="co">#&gt;  $ terminal                   : chr  "International" "International" "International" "International" ...</span>
<span class="co">#&gt;  $ boarding_area              : chr  "G" "G" "A" "A" ...</span>
<span class="co">#&gt;  $ passenger_count            : int  12405 15151 13131 14985 2543 2883 1772 1370 2817 1987 ...</span></code></pre></div>
<p>In the case of the <code>sfo_passengers</code> dataset, ignoring the date indicator, we have one numeric variable - <code>passenger_count</code> and ten categorical variables. For the following examples, we will focus on the total number of passengers during 2022, the last full year in the dataset:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="va">d</span> <span class="op">&lt;-</span> <span class="va">sfo_passengers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">activity_period</span> <span class="op">&gt;=</span> <span class="fl">202201</span> <span class="op">&amp;</span> <span class="va">activity_period</span> <span class="op">&lt;</span> <span class="fl">202301</span><span class="op">)</span></code></pre></div>
<p>Now, we can start explore the distribution of the passengers by different categorical variables combination. Let’s start with a simplistic example, plotting the distribution of passengers by <code>geo_sumary</code> and <code>geo_region</code>. The <code>sunkey_ly</code> function required that the data will be aggregated by the categorical variables:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d1</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_summary</span>, <span class="va">geo_region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">passenger_count</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d1</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="co">#&gt;   geo_summary   geo_region             total</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Domestic      US                  46<span style="text-decoration: underline;">955</span>185</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> International Asia                 3<span style="text-decoration: underline;">102</span>633</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> International Australia / Oceania   <span style="text-decoration: underline;">753</span>566</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> International Canada               1<span style="text-decoration: underline;">919</span>214</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> International Central America       <span style="text-decoration: underline;">431</span>108</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> International Europe               4<span style="text-decoration: underline;">905</span>078</span></code></pre></div>
<p>Now, as the data is ready, we visualize the data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/sankey_ly.html">sankey_ly</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">d1</span>, 
          cat_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geo_summary"</span>, <span class="st">"geo_region"</span><span class="op">)</span>, 
          num_col <span class="op">=</span> <span class="st">"total"</span>, 
          title <span class="op">=</span> <span class="st">"Distribution of Passengers by Geo Type and Region During 2022"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-250a4aa80bc1bb57b1d7" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-250a4aa80bc1bb57b1d7">{"x":{"visdat":{"2aa3e78f3ab":["function () ","plotlyVisDat"]},"cur_data":"2aa3e78f3ab","attrs":{"2aa3e78f3ab":{"orientation":"h","valueformat":".0f","node":{"label":["Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,1,1,1,1,1,1,1],"target":[2,3,4,5,6,7,8,9],"value":[46955185,3102633,753566,1919214,431108,4905078,1886146,879402]},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"sankey"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribution of Passengers by Geo Type and Region During 2022","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"orientation":"h","valueformat":".0f","node":{"label":["Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,1,1,1,1,1,1,1],"target":[2,3,4,5,6,7,8,9],"value":[46955185,3102633,753566,1919214,431108,4905078,1886146,879402]},"type":"sankey","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>Similarly, we can add additional variables:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">operating_airline</span> <span class="op">==</span> <span class="st">"United Airlines"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">operating_airline</span>,<span class="va">activity_type_code</span>, <span class="va">geo_summary</span>, <span class="va">geo_region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">passenger_count</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/sankey_ly.html">sankey_ly</a></span><span class="op">(</span>cat_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"operating_airline"</span>, <span class="st">"geo_summary"</span>, <span class="st">"geo_region"</span>, <span class="st">"activity_type_code"</span><span class="op">)</span>, 
            num_col <span class="op">=</span> <span class="st">"total"</span>,
            title <span class="op">=</span> <span class="st">"Distribution of United Airlines Passengers at SFO During 2022"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-9add16d7ef26a9573d9e" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9add16d7ef26a9573d9e">{"x":{"visdat":{"2aa369eb7951":["function () ","plotlyVisDat"]},"cur_data":"2aa369eb7951","attrs":{"2aa369eb7951":{"orientation":"h","valueformat":".0f","node":{"label":["United Airlines","Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East","Deplaned","Enplaned","Thru / Transit"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,0,1,2,2,2,2,2,2,2,4,4,5,5,6,6,7,7,8,8,9,9,10,10,3,3,3],"target":[1,2,3,4,5,6,7,8,9,10,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,13],"value":[20765481,4514526,20765481,1030697,493556,369004,18438,1457827,957194,187810,522056,508641,249743,243813,175857,193147,9386,9052,709706,748121,475991,481203,93106,94704,10394198,10364943,6340]},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"sankey"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribution of United Airlines Passengers at SFO During 2022","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"orientation":"h","valueformat":".0f","node":{"label":["United Airlines","Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East","Deplaned","Enplaned","Thru / Transit"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,0,1,2,2,2,2,2,2,2,4,4,5,5,6,6,7,7,8,8,9,9,10,10,3,3,3],"target":[1,2,3,4,5,6,7,8,9,10,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,13],"value":[20765481,4514526,20765481,1030697,493556,369004,18438,1457827,957194,187810,522056,508641,249743,243813,175857,193147,9386,9052,709706,748121,475991,481203,93106,94704,10394198,10364943,6340]},"type":"sankey","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="failure">Failure!<a class="anchor" aria-label="anchor" href="#failure"></a>
</h3>
<p>Here is some pitful you should be aware of, the function is sensitive to the categorical variables’ names. If two variables share the same unique label, it will fail to map the different categories correctly. The following example, where both the <code>geo_summary</code> and <code>terminal</code> variables share the label <code>international</code>, demonstrates this issue:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">operating_airline</span> <span class="op">==</span> <span class="st">"United Airlines"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">operating_airline</span>,<span class="va">activity_type_code</span>, <span class="va">geo_summary</span>, <span class="va">geo_region</span>,  <span class="va">terminal</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">passenger_count</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/sankey_ly.html">sankey_ly</a></span><span class="op">(</span>cat_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"operating_airline"</span>, <span class="st">"geo_summary"</span>, <span class="st">"geo_region"</span>, <span class="st">"activity_type_code"</span>, <span class="st">"terminal"</span><span class="op">)</span>, 
            num_col <span class="op">=</span> <span class="st">"total"</span>,
            title <span class="op">=</span> <span class="st">"Distribution of United Airlines Passengers at SFO During 2022"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-936ff49c102d313a01ae" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-936ff49c102d313a01ae">{"x":{"visdat":{"2aa317ce44e0":["function () ","plotlyVisDat"]},"cur_data":"2aa317ce44e0","attrs":{"2aa317ce44e0":{"orientation":"h","valueformat":".0f","node":{"label":["United Airlines","Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East","Deplaned","Enplaned","Thru / Transit","International","Terminal 3"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,0,0,1,2,14,2,14,2,14,2,14,2,14,2,14,2,14,4,4,5,5,6,6,7,7,8,8,9,9,10,10,3,3,3,11,11,11,12,12,12,13],"target":[1,2,14,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,13,2,14,15,2,14,15,15],"value":[20765481,4514526,4514526,20765481,1030697,1030697,493556,493556,369004,369004,18438,18438,1457827,1457827,957194,957194,187810,187810,522056,508641,249743,243813,175857,193147,9386,9052,709706,748121,475991,481203,93106,94704,10394198,10364943,6340,2612378,2612378,10017665,2370327,2370327,10273297,6340]},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"sankey"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribution of United Airlines Passengers at SFO During 2022","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"orientation":"h","valueformat":".0f","node":{"label":["United Airlines","Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East","Deplaned","Enplaned","Thru / Transit","International","Terminal 3"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,0,0,1,2,14,2,14,2,14,2,14,2,14,2,14,2,14,4,4,5,5,6,6,7,7,8,8,9,9,10,10,3,3,3,11,11,11,12,12,12,13],"target":[1,2,14,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,13,2,14,15,2,14,15,15],"value":[20765481,4514526,4514526,20765481,1030697,1030697,493556,493556,369004,369004,18438,18438,1457827,1457827,957194,957194,187810,187810,522056,508641,249743,243813,175857,193147,9386,9052,709706,748121,475991,481203,93106,94704,10394198,10364943,6340,2612378,2612378,10017665,2370327,2370327,10273297,6340]},"type":"sankey","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>To overcome this issue, you will have to ensure no overlapping between the variables’ labels. Let’s modify the cases where the terminal variable is set as <code>International</code> to <code>international</code> (<code>I</code> -&gt; <code>i</code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">operating_airline</span> <span class="op">==</span> <span class="st">"United Airlines"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>terminal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">terminal</span> <span class="op">==</span> <span class="st">"International"</span>, <span class="st">"international"</span>, <span class="va">terminal</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">operating_airline</span>,<span class="va">activity_type_code</span>, <span class="va">geo_summary</span>, <span class="va">geo_region</span>,  <span class="va">terminal</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">passenger_count</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/sankey_ly.html">sankey_ly</a></span><span class="op">(</span>cat_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"operating_airline"</span>, <span class="st">"terminal"</span>,<span class="st">"geo_summary"</span>, <span class="st">"geo_region"</span>, <span class="st">"activity_type_code"</span><span class="op">)</span>, 
            num_col <span class="op">=</span> <span class="st">"total"</span>,
            title <span class="op">=</span> <span class="st">"Distribution of United Airlines Passengers at SFO During 2022"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-640a8bf6854a05aa80b1" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-640a8bf6854a05aa80b1">{"x":{"visdat":{"2aa33b2b374d":["function () ","plotlyVisDat"]},"cur_data":"2aa33b2b374d","attrs":{"2aa33b2b374d":{"orientation":"h","valueformat":".0f","node":{"label":["United Airlines","international","Terminal 3","Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East","Deplaned","Enplaned","Thru / Transit"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,0,1,1,2,2,3,4,4,4,4,4,4,4,6,6,7,7,8,8,9,9,10,10,11,11,12,12,5,5,5],"target":[1,2,3,4,3,4,5,6,7,8,9,10,11,12,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,15],"value":[4982705,20297302,1099071,3883634,19666410,630892,20765481,1030697,493556,369004,18438,1457827,957194,187810,522056,508641,249743,243813,175857,193147,9386,9052,709706,748121,475991,481203,93106,94704,10394198,10364943,6340]},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"sankey"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribution of United Airlines Passengers at SFO During 2022","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"orientation":"h","valueformat":".0f","node":{"label":["United Airlines","international","Terminal 3","Domestic","International","US","Asia","Australia / Oceania","Canada","Central America","Europe","Mexico","Middle East","Deplaned","Enplaned","Thru / Transit"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,0,1,1,2,2,3,4,4,4,4,4,4,4,6,6,7,7,8,8,9,9,10,10,11,11,12,12,5,5,5],"target":[1,2,3,4,3,4,5,6,7,8,9,10,11,12,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,15],"value":[4982705,20297302,1099071,3883634,19666410,630892,20765481,1030697,493556,369004,18438,1457827,957194,187810,522056,508641,249743,243813,175857,193147,9386,9052,709706,748121,475991,481203,93106,94704,10394198,10364943,6340]},"type":"sankey","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rami Krispin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
