<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyzing SFO Passengers • sfo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing SFO Passengers">
<meta property="og:description" content="sfo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v1_intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/v2_analyzing_sfo.html">Analyzing SFO Passengers</a>
    </li>
    <li>
      <a href="../articles/v3_analyzing_landing.html">Analyzing SFO Landing</a>
    </li>
    <li>
      <a href="../articles/v3_sankey.html">Create Sankey Diagram</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="v2_analyzing_sfo_files/header-attrs-2.5/header-attrs.js"></script><link href="v2_analyzing_sfo_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="v2_analyzing_sfo_files/anchor-sections-1.0/anchor-sections.js"></script><script src="v2_analyzing_sfo_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="v2_analyzing_sfo_files/plotly-binding-4.9.2.1/plotly.js"></script><script src="v2_analyzing_sfo_files/typedarray-0.1/typedarray.min.js"></script><script src="v2_analyzing_sfo_files/jquery-1.11.3/jquery.min.js"></script><link href="v2_analyzing_sfo_files/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="v2_analyzing_sfo_files/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="v2_analyzing_sfo_files/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="v2_analyzing_sfo_files/plotly-main-1.52.2/plotly-latest.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analyzing SFO Passengers</h1>
            
      
      
      <div class="hidden name"><code>v2_analyzing_sfo.Rmd</code></div>

    </div>

    
    
<p>The <code>sfo_passengers</code> dataset provides monthly statistics about the air traffic passengers in San Francisco International Airport between July 2005 and September 2020. The focus of this vignette is on an exploratory analysis approaches for this dataset.</p>
<div id="data-prep" class="section level3">
<h3 class="hasAnchor">
<a href="#data-prep" class="anchor"></a>Data prep</h3>
<p>We will start with reviewing the data structure:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">sfo</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"sfo_passengers"</span>)
</pre></div>
<p>For simplicity, let’s use a shorter name , <code>d</code>, for the dataset:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">

<span class="kw">d</span> <span class="op">&lt;-</span> <span class="kw">sfo_passengers</span>
</pre></div>
<p>Next let’s review the characteristics of the dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">d</span>)
<span class="co">#&gt;   activity_period operating_airline operating_airline_iata_code</span>
<span class="co">#&gt; 1          202009   United Airlines                          UA</span>
<span class="co">#&gt; 2          202009   United Airlines                          UA</span>
<span class="co">#&gt; 3          202009   United Airlines                          UA</span>
<span class="co">#&gt; 4          202009   United Airlines                          UA</span>
<span class="co">#&gt; 5          202009   United Airlines                          UA</span>
<span class="co">#&gt; 6          202009   United Airlines                          UA</span>
<span class="co">#&gt;   published_airline published_airline_iata_code   geo_summary geo_region</span>
<span class="co">#&gt; 1   United Airlines                          UA International     Mexico</span>
<span class="co">#&gt; 2   United Airlines                          UA International     Mexico</span>
<span class="co">#&gt; 3   United Airlines                          UA International     Mexico</span>
<span class="co">#&gt; 4   United Airlines                          UA International     Mexico</span>
<span class="co">#&gt; 5   United Airlines                          UA International     Europe</span>
<span class="co">#&gt; 6   United Airlines                          UA International     Europe</span>
<span class="co">#&gt;   activity_type_code price_category_code      terminal boarding_area</span>
<span class="co">#&gt; 1           Enplaned               Other    Terminal 3             F</span>
<span class="co">#&gt; 2           Enplaned               Other    Terminal 3             E</span>
<span class="co">#&gt; 3           Enplaned               Other International             G</span>
<span class="co">#&gt; 4           Deplaned               Other International             G</span>
<span class="co">#&gt; 5           Enplaned               Other International             G</span>
<span class="co">#&gt; 6           Deplaned               Other International             G</span>
<span class="co">#&gt;   passenger_count</span>
<span class="co">#&gt; 1            6712</span>
<span class="co">#&gt; 2             396</span>
<span class="co">#&gt; 3             376</span>
<span class="co">#&gt; 4            6817</span>
<span class="co">#&gt; 5            3851</span>
<span class="co">#&gt; 6            3700</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">d</span>)
<span class="co">#&gt; 'data.frame':    22576 obs. of  12 variables:</span>
<span class="co">#&gt;  $ activity_period            : int  202009 202009 202009 202009 202009 202009 202009 202009 202009 202009 ...</span>
<span class="co">#&gt;  $ operating_airline          : chr  "United Airlines" "United Airlines" "United Airlines" "United Airlines" ...</span>
<span class="co">#&gt;  $ operating_airline_iata_code: chr  "UA" "UA" "UA" "UA" ...</span>
<span class="co">#&gt;  $ published_airline          : chr  "United Airlines" "United Airlines" "United Airlines" "United Airlines" ...</span>
<span class="co">#&gt;  $ published_airline_iata_code: chr  "UA" "UA" "UA" "UA" ...</span>
<span class="co">#&gt;  $ geo_summary                : chr  "International" "International" "International" "International" ...</span>
<span class="co">#&gt;  $ geo_region                 : chr  "Mexico" "Mexico" "Mexico" "Mexico" ...</span>
<span class="co">#&gt;  $ activity_type_code         : chr  "Enplaned" "Enplaned" "Enplaned" "Deplaned" ...</span>
<span class="co">#&gt;  $ price_category_code        : chr  "Other" "Other" "Other" "Other" ...</span>
<span class="co">#&gt;  $ terminal                   : chr  "Terminal 3" "Terminal 3" "International" "International" ...</span>
<span class="co">#&gt;  $ boarding_area              : chr  "F" "E" "G" "G" ...</span>
<span class="co">#&gt;  $ passenger_count            : int  6712 396 376 6817 3851 3700 71 83 65 45 ...</span>
</pre></div>
<p>The <code>activity_period</code> variable provides the year-month of the observation using integer format. That is convenient if we want to filter by year and month, but less convenient if we want to plot the data as time series. Therefore, we will reformat the variable from YYYYMM to YYYYMMDD, setting the month’s day as 1st with the <code>as.Date</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">d</span><span class="op">$</span><span class="kw">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="kw">d</span><span class="op">$</span><span class="kw">activity_period</span>, <span class="fl">1</span>,<span class="fl">4</span>), <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="kw">d</span><span class="op">$</span><span class="kw">activity_period</span>, <span class="fl">5</span>,<span class="fl">6</span>), <span class="st">"01"</span>, sep =<span class="st">"/"</span>))

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">d</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"activity_period"</span>, <span class="st">"date"</span>)])
<span class="co">#&gt;   activity_period       date</span>
<span class="co">#&gt; 1          202009 2020-09-01</span>
<span class="co">#&gt; 2          202009 2020-09-01</span>
<span class="co">#&gt; 3          202009 2020-09-01</span>
<span class="co">#&gt; 4          202009 2020-09-01</span>
<span class="co">#&gt; 5          202009 2020-09-01</span>
<span class="co">#&gt; 6          202009 2020-09-01</span>

<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="kw">d</span><span class="op">$</span><span class="kw">date</span>)
<span class="co">#&gt; [1] "2005-07-01"</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="kw">d</span><span class="op">$</span><span class="kw">date</span>)
<span class="co">#&gt; [1] "2020-09-01"</span>
</pre></div>
</div>
<div id="exploratory-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#exploratory-analysis" class="anchor"></a>Exploratory analysis</h3>
<p>After we reviewed and reformat the data, we can start explore the data and answer some questions such as:</p>
<ul>
<li><p>The monthly number of passengers at SFO</p></li>
<li><p>The airlines distribution</p></li>
<li><p>The geographic distribution of the passengers</p></li>
</ul>
<div id="monthly-number-of-passengers" class="section level4">
<h4 class="hasAnchor">
<a href="#monthly-number-of-passengers" class="anchor"></a>Monthly number of passengers</h4>
<p>There are multiple ways to aggregate the datasets for monthly time-series data, such as the passengers’ travel type (arrival vs. departure), geo type, and their combination. Let’s start with the total aggregation of the data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://plotly-r.com">plotly</a></span>)

<span class="kw">d_total</span> <span class="op">&lt;-</span> <span class="kw">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">date</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(total = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">passenger_count</span>))

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">d_total</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   date         total</span>
<span class="co">#&gt;   &lt;date&gt;       &lt;int&gt;</span>
<span class="co">#&gt; 1 2005-07-01 3225769</span>
<span class="co">#&gt; 2 2005-08-01 3195866</span>
<span class="co">#&gt; 3 2005-09-01 2740553</span>
<span class="co">#&gt; 4 2005-10-01 2770715</span>
<span class="co">#&gt; 5 2005-11-01 2617333</span>
<span class="co">#&gt; 6 2005-12-01 2671797</span>

<span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span>(data = <span class="kw">d_total</span>,
        x = <span class="op">~</span> <span class="kw">date</span>,
        y = <span class="op">~</span> <span class="kw">total</span>,
        type = <span class="st">"scatter"</span>,
        mode = <span class="st">"lines"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span>(title = <span class="st">"Monthly Air Traffic Passengers at SFO"</span>,
         yaxis = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(title = <span class="st">"Number of Passengers"</span>),
         xaxis = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(title = <span class="st">"Source: San Francisco data portal (DataSF)"</span>))
</pre></div>
<div id="htmlwidget-e6ab91180de87d2da6de" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e6ab91180de87d2da6de">{"x":{"visdat":{"aa2e424c3437":["function () ","plotlyVisDat"]},"cur_data":"aa2e424c3437","attrs":{"aa2e424c3437":{"x":{},"y":{},"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Monthly Air Traffic Passengers at SFO","yaxis":{"domain":[0,1],"automargin":true,"title":"Number of Passengers"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: San Francisco data portal (DataSF)"},"hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01"],"y":[3225769,3195866,2740553,2770715,2617333,2671797,2448889,2223024,2708778,2773293,2829000,3071396,3227605,3143839,2720100,2834959,2653887,2698200,2507430,2304990,2820085,2869247,3056934,3263621,3382382,3436417,2957530,3129309,2922500,2903637,2670053,2595676,3127387,3029021,3305954,3453751,3603946,3612297,3004720,3124451,2744485,2962937,2644539,2359800,2925918,3024973,3177100,3419595,3649702,3650668,3191526,3249428,2971484,3074209,2785466,2515361,3105958,3139059,3380355,3612886,3765824,3771842,3356365,3490100,3163659,3167124,2883810,2610667,3129205,3200527,3547804,3766323,3935589,3917884,3564970,3602455,3326859,3441693,3211600,2998119,3472440,3563007,3820570,4107195,4284443,4356216,3819379,3844987,3478890,3443039,3204637,2966477,3593364,3604104,3933016,4146797,4176486,4347059,3781168,3910790,3466878,3814984,3432625,3078405,3765504,3881893,4147096,4321833,4499221,4524918,3919072,4059443,3628786,3855835,3550084,3248144,4001521,4021677,4361140,4558511,4801148,4796653,4201394,4374749,4013814,4129052,3748529,3543639,4137679,4172512,4573996,4922125,5168724,5110638,4543759,4571997,4266481,4343369,3897685,3481405,4335287,4425920,4698067,5134110,5496516,5516837,4736005,4868674,4572702,4660504,4190367,3882181,4674035,4713183,5025595,5427144,5692572,5545859,4649100,4861782,4508606,4576449,4156821,3752763,4599189,4692941,5008001,5466688,5612312,5742437,4471408,4824559,4370463,4720992,4241751,3742224,1885466,138817,286570,555119,765274,852578,905992],"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>The covid19 pandemic effect can be seen in the series above, as the number of passengers had a sharp drop in March 2020.</p>
<p>Likewise, we can aggregate the data by the activity type (arrival, departure, transit):</p>
<div class="sourceCode" id="cb6"><pre class="downlit">

<span class="kw">d_activity_type</span> <span class="op">&lt;-</span> <span class="kw">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">date</span>, <span class="kw">activity_type_code</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(total = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">passenger_count</span>), .groups = <span class="st">"drop"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">d_activity_type</span>)
<span class="co">#&gt;         date activity_type_code   total</span>
<span class="co">#&gt; 1 2005-07-01           Deplaned 1627329</span>
<span class="co">#&gt; 2 2005-07-01           Enplaned 1569412</span>
<span class="co">#&gt; 3 2005-07-01     Thru / Transit   29028</span>
<span class="co">#&gt; 4 2005-08-01           Deplaned 1614468</span>
<span class="co">#&gt; 5 2005-08-01           Enplaned 1553146</span>
<span class="co">#&gt; 6 2005-08-01     Thru / Transit   28252</span>

<span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span>(data = <span class="kw">d_activity_type</span>,
        x = <span class="op">~</span> <span class="kw">date</span>,
        y = <span class="op">~</span> <span class="kw">total</span>,
        color = <span class="op">~</span> <span class="kw">activity_type_code</span>,
        type = <span class="st">"scatter"</span>,
        mode = <span class="st">"lines"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span>(title = <span class="st">"Monthly Air Traffic Passengers at SFO by Activity Type"</span>,
         yaxis = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(title = <span class="st">"Number of Passengers"</span>),
         xaxis = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(title = <span class="st">"Source: San Francisco data portal (DataSF)"</span>))
</pre></div>
<div id="htmlwidget-10dda8568c2aa9c3f773" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-10dda8568c2aa9c3f773">{"x":{"visdat":{"aa2e4c441a3c":["function () ","plotlyVisDat"]},"cur_data":"aa2e4c441a3c","attrs":{"aa2e4c441a3c":{"x":{},"y":{},"mode":"lines","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Monthly Air Traffic Passengers at SFO by Activity Type","yaxis":{"domain":[0,1],"automargin":true,"title":"Number of Passengers"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: San Francisco data portal (DataSF)"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01"],"y":[1627329,1614468,1353447,1358128,1291602,1297510,1243753,1104323,1341056,1382597,1402609,1480683,1623247,1583441,1348295,1400970,1310983,1304564,1270145,1142067,1390044,1426568,1511517,1589563,1703427,1725895,1470257,1543577,1444998,1412715,1357632,1282855,1547424,1505963,1636765,1702640,1824562,1820030,1497291,1546151,1353890,1463338,1344183,1177412,1460748,1514255,1575534,1673154,1841292,1851368,1581818,1606428,1472565,1514222,1414991,1256290,1551596,1567002,1682836,1763151,1906201,1912714,1661749,1725252,1569727,1565563,1464512,1306930,1557780,1598458,1766258,1854617,1991538,1981339,1772454,1788962,1648305,1690271,1632755,1497324,1724513,1792353,1900287,2024013,2175023,2184914,1916588,1906211,1730629,1689762,1641233,1485424,1792120,1824070,1942381,2046400,2111798,2188184,1892514,1937528,1706441,1893878,1751302,1541774,1879460,1959556,2064092,2135787,2296541,2275155,1970239,2024053,1798119,1913656,1812521,1636133,1999996,2028066,2186927,2247789,2448567,2438908,2101544,2158013,1996103,2039094,1921795,1789766,2066432,2109355,2296057,2422088,2650944,2593874,2287271,2286462,2127669,2132261,2016637,1750071,2153639,2224301,2355351,2519029,2808352,2796449,2358537,2427942,2271196,2270973,2172552,1944768,2320899,2393156,2510276,2658235,2905562,2798782,2340188,2425591,2258229,2235904,2148066,1875859,2278985,2393952,2497897,2665667,2850432,2889791,2247754,2392572,2129479,2313600,2186406,1882350,952557,70582,141790,270718,377145,418398,442442],"mode":"lines","type":"scatter","name":"Deplaned","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01"],"y":[1569412,1553146,1363140,1384822,1304433,1350000,1182313,1094470,1337770,1371576,1408991,1570272,1583055,1539211,1353586,1417003,1325354,1374406,1217679,1144391,1405982,1420480,1521884,1650947,1656412,1687024,1471094,1568276,1465087,1477301,1297099,1294648,1560380,1504074,1653760,1738334,1761579,1774735,1499313,1569545,1383133,1491674,1290035,1173406,1454796,1500465,1592457,1733926,1798641,1790589,1602188,1633418,1490890,1550460,1359375,1249672,1541956,1559704,1687160,1836349,1846490,1845624,1683566,1752673,1585534,1591589,1409136,1295211,1561541,1593407,1771329,1900610,1932621,1923748,1783953,1804254,1670612,1742295,1571845,1493150,1739289,1764188,1915521,2078066,2103777,2165149,1890812,1934113,1744729,1747550,1558685,1478579,1794640,1774595,1988752,2092041,2060059,2154833,1884343,1957611,1756833,1916814,1675812,1533190,1879974,1916848,2078697,2180660,2195683,2248755,1948420,2034949,1830334,1941106,1736575,1611621,2000314,1992518,2173731,2309593,2351298,2356914,2099362,2216408,2017137,2089548,1825846,1753761,2070896,2062962,2277536,2499842,2517460,2515152,2255391,2285426,2137473,2210506,1880986,1731259,2181301,2201044,2340961,2614453,2686861,2718481,2376714,2440276,2300751,2389342,2016637,1936989,2352210,2318680,2513125,2763785,2779507,2740357,2302919,2430076,2245913,2336093,2003649,1873694,2316520,2294140,2505020,2793918,2754032,2844325,2217062,2425539,2235301,2401871,2050756,1856937,931666,68235,144780,284401,388129,434000,463550],"mode":"lines","type":"scatter","name":"Enplaned","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-08-01"],"y":[29028,28252,23966,27765,21298,24287,22823,24231,29952,19120,17400,20441,21303,21187,18219,16986,17550,19230,19606,18532,24059,22199,23533,23111,22543,23498,16179,17456,12415,13621,15322,18173,19583,18984,15429,12777,17805,17532,8116,8755,7462,7925,10321,8982,10374,10253,9109,12515,9769,8711,7520,9582,8029,9527,11100,9399,12406,12353,10359,13386,13133,13504,11050,12175,8398,9972,10162,8526,9884,8662,10217,11096,11430,12797,8563,9239,7942,9127,7000,7645,8638,6466,4762,5116,5643,6153,11979,4663,3532,5727,4719,2474,6604,5439,1883,8356,4629,4042,4311,15651,3604,4292,5511,3441,6070,5489,4307,5386,6997,1008,413,441,333,1073,988,390,1211,1093,482,1129,1283,831,488,328,574,410,888,112,351,195,403,195,320,1612,1097,109,1339,602,62,75,347,575,1755,628,1303,1907,754,456,755,189,1178,424,926,1347,2194,5124,7503,6720,5993,6115,4464,4452,5106,3210,3684,4849,5084,7103,7848,8321,6592,6448,5683,5521,4589,2937,1243,180],"mode":"lines","type":"scatter","name":"Thru / Transit","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>The following plot provides the distribution of passengers by the flight geo type (international vs. domestic). We will use the <code>pivot_wider</code> function from the <strong>tidyr</strong> package to transform the <code>data.frame</code> into a wide format:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://tidyr.tidyverse.org">tidyr</a></span>)

<span class="kw">d_geo</span> <span class="op">&lt;-</span> <span class="kw">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">date</span>, <span class="kw">geo_summary</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(total = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">passenger_count</span>), .groups = <span class="st">"drop"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(names_from = <span class="kw">geo_summary</span>, values_from = <span class="kw">total</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">d_geo</span>)
<span class="co">#&gt;         date Domestic International</span>
<span class="co">#&gt; 1 2005-07-01  2425902        799867</span>
<span class="co">#&gt; 2 2005-08-01  2405904        789962</span>
<span class="co">#&gt; 3 2005-09-01  2067923        672630</span>
<span class="co">#&gt; 4 2005-10-01  2095119        675596</span>
<span class="co">#&gt; 5 2005-11-01  1998879        618454</span>
<span class="co">#&gt; 6 2005-12-01  2003840        667957</span>

<span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span>(data = <span class="kw">d_geo</span>, 
        x = <span class="op">~</span> <span class="kw">date</span>, 
        y = <span class="op">~</span> <span class="kw">Domestic</span>, 
        name = <span class="st">"Domestic"</span>, 
        type = <span class="st">"scatter"</span>, 
        mode = <span class="st">"none"</span>, 
        stackgroup = <span class="st">"one"</span>, 
        groupnorm = <span class="st">"percent"</span>, fillcolor = <span class="st">"#4C74C9"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span>(y = <span class="op">~</span> <span class="kw">International</span>,
            name = <span class="st">"International"</span>,
            fillcolor = <span class="st">"#50CB86"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span>(title = <span class="st">'United States Personal Expenditures by Categories'</span>,
         yaxis = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(title = <span class="st">"Proportion of Passengers"</span>, 
                      showgrid = <span class="fl">FALSE</span>,
                      ticksuffix = <span class="st">"%"</span>),
         xaxis = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(title = <span class="st">"Source: San Francisco data portal (DataSF)"</span>,
                      showgrid = <span class="fl">FALSE</span>))
</pre></div>
<div id="htmlwidget-e78fb3e4f348d1df993c" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e78fb3e4f348d1df993c">{"x":{"visdat":{"aa2e723e72bd":["function () ","plotlyVisDat"]},"cur_data":"aa2e723e72bd","attrs":{"aa2e723e72bd":{"x":{},"y":{},"mode":"none","stackgroup":"one","groupnorm":"percent","fillcolor":"#4C74C9","name":"Domestic","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"aa2e723e72bd.1":{"x":{},"y":{},"mode":"none","stackgroup":"one","groupnorm":"percent","fillcolor":"#50CB86","name":"International","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"United States Personal Expenditures by Categories","yaxis":{"domain":[0,1],"automargin":true,"title":"Proportion of Passengers","showgrid":false,"ticksuffix":"%"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: San Francisco data portal (DataSF)","showgrid":false},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01"],"y":[2425902,2405904,2067923,2095119,1998879,2003840,1777970,1654332,2021211,2060067,2098827,2283880,2388582,2329326,2031313,2125701,1989899,1984825,1796958,1693076,2085306,2135262,2285661,2450337,2514365,2579979,2215029,2369556,2213515,2144133,1917115,1936772,2343637,2298771,2516561,2622840,2733106,2738028,2293054,2410081,2128392,2263215,1969369,1823273,2279999,2333638,2486507,2653787,2821379,2816869,2470252,2559254,2359949,2405185,2129669,1953459,2432351,2462282,2604074,2766936,2854580,2883478,2575445,2713691,2506004,2475223,2188831,2027296,2444460,2485934,2733013,2916035,3038721,3029332,2781154,2829239,2676051,2721962,2491978,2381898,2760730,2800588,2955858,3187511,3337400,3403584,2981537,3035032,2789471,2711230,2497759,2353427,2860027,2852814,3051600,3211986,3219791,3362104,2921352,3072951,2760327,3037334,2665476,2407604,2982900,3074054,3211422,3337175,3474835,3494105,3042985,3216218,2896972,3041095,2742717,2528565,3157697,3155573,3357598,3487784,3661816,3659585,3247678,3422245,3178790,3214275,2832614,2746123,3227881,3244410,3522786,3745243,3905150,3873557,3463521,3530551,3344540,3300499,2888610,2644126,3350116,3362995,3561756,3829335,4098395,4135082,3579260,3764139,3593895,3590008,3144332,2963364,3579413,3630813,3818359,4039838,4239662,4129456,3447522,3674021,3418372,3404846,3008022,2763185,3449863,3488572,3665783,3972171,4081947,4228225,3192185,3579123,3229587,3457356,3038414,2870854,1431537,121707,268489,510795,694324,750586,803620],"mode":"none","stackgroup":"one","groupnorm":"percent","fillcolor":"#4C74C9","name":"Domestic","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01"],"y":[799867,789962,672630,675596,618454,667957,670919,568692,687567,713226,730173,787516,839023,814513,688787,709258,663988,713375,710472,611914,734779,733985,771273,813284,868017,856438,742501,759753,708985,759504,752938,658904,783750,730250,789393,830911,870840,874269,711666,714370,616093,699722,675170,536527,645919,691335,690593,765808,828323,833799,721274,690174,611535,669024,655797,561902,673607,676777,776281,845950,911244,888364,780920,776409,657655,691901,694979,583371,684745,714593,814791,850288,896868,888552,783816,773216,650808,719731,719622,616221,711710,762419,864712,919684,947043,952632,837842,809955,689419,731809,706878,613050,733337,751290,881416,934811,956695,984955,859816,837839,706551,777650,767149,670801,782604,807839,935674,984658,1024386,1030813,876087,843225,731814,814740,807367,719579,843824,866104,1003542,1070727,1139332,1137068,953716,952504,835024,914777,915915,797516,909798,928102,1051210,1176882,1263574,1237081,1080238,1041446,921941,1042870,1009075,837279,985171,1062925,1136311,1304775,1398121,1381755,1156745,1104535,978807,1070496,1046035,918817,1094622,1082370,1207236,1387306,1452910,1416403,1201578,1187761,1090234,1171603,1148799,989578,1149326,1204369,1342218,1494517,1530365,1514212,1279223,1245436,1140876,1263636,1203337,871370,453929,17110,18081,44324,70950,101992,102372],"mode":"none","stackgroup":"one","groupnorm":"percent","fillcolor":"#50CB86","name":"International","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>As expected, the distribution of passengers by geo type changed since the start of the covid19 pandemic, increasing domestic flights’ proportion.</p>
</div>
<div id="airlines-analysis" class="section level4">
<h4 class="hasAnchor">
<a href="#airlines-analysis" class="anchor"></a>Airlines Analysis</h4>
<p>The dataset provides two indicator about the airline company:</p>
<ul>
<li><p><code>operating_airline</code> filed describe the aircraft operator name, and</p></li>
<li><p><code>published_airline</code> filed describe the name of the airline that issues the ticket and books revenue</p></li>
</ul>
<p>In most of the cases it is the same company, in other cases, such as code-sharing operator it may two different companies. Let’s review the characteristics of those variables:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">d</span><span class="op">$</span><span class="kw">operating_airline</span>))
<span class="co">#&gt; [1] 94</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">d</span><span class="op">$</span><span class="kw">published_airline</span>))
<span class="co">#&gt; [1] 84</span>
</pre></div>
<p>You can notice that there are fewer published airlines compared to operating airlines. This potentially means that some operating airlines have lines with code sharing. For simplicity, we will focus on the <code>operating_airline</code> variable. Let’s review the unique combination of this variable:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">d</span><span class="op">$</span><span class="kw">operating_airline</span>))
<span class="co">#&gt;  [1] "ABC Aerolineas S.A. de C.V. dba Interjet"</span>
<span class="co">#&gt;  [2] "Aer Lingus"                              </span>
<span class="co">#&gt;  [3] "Aeromexico"                              </span>
<span class="co">#&gt;  [4] "Air Berlin"                              </span>
<span class="co">#&gt;  [5] "Air Canada"                              </span>
<span class="co">#&gt;  [6] "Air Canada Jazz"                         </span>
<span class="co">#&gt;  [7] "Air China"                               </span>
<span class="co">#&gt;  [8] "Air France"                              </span>
<span class="co">#&gt;  [9] "Air India Limited"                       </span>
<span class="co">#&gt; [10] "Air Italy S.P.A"                         </span>
<span class="co">#&gt; [11] "Air New Zealand"                         </span>
<span class="co">#&gt; [12] "Air Pacific Limited dba Fiji Airways"    </span>
<span class="co">#&gt; [13] "AirTran Airways"                         </span>
<span class="co">#&gt; [14] "Alaska Airlines"                         </span>
<span class="co">#&gt; [15] "All Nippon Airways"                      </span>
<span class="co">#&gt; [16] "Allegiant Air"                           </span>
<span class="co">#&gt; [17] "American Airlines"                       </span>
<span class="co">#&gt; [18] "American Eagle Airlines"                 </span>
<span class="co">#&gt; [19] "Ameriflight"                             </span>
<span class="co">#&gt; [20] "Asiana Airlines"                         </span>
<span class="co">#&gt; [21] "ATA Airlines"                            </span>
<span class="co">#&gt; [22] "Atlantic Southeast Airlines"             </span>
<span class="co">#&gt; [23] "Atlas Air, Inc"                          </span>
<span class="co">#&gt; [24] "BelAir Airlines"                         </span>
<span class="co">#&gt; [25] "Boeing Company"                          </span>
<span class="co">#&gt; [26] "British Airways"                         </span>
<span class="co">#&gt; [27] "Cathay Pacific"                          </span>
<span class="co">#&gt; [28] "China Airlines"                          </span>
<span class="co">#&gt; [29] "China Eastern"                           </span>
<span class="co">#&gt; [30] "China Southern"                          </span>
<span class="co">#&gt; [31] "Compass Airlines"                        </span>
<span class="co">#&gt; [32] "COPA Airlines, Inc."                     </span>
<span class="co">#&gt; [33] "Delta Air Lines"                         </span>
<span class="co">#&gt; [34] "El Al Israel Airlines LTD."              </span>
<span class="co">#&gt; [35] "Emirates"                                </span>
<span class="co">#&gt; [36] "Etihad Airways"                          </span>
<span class="co">#&gt; [37] "EVA Airways"                             </span>
<span class="co">#&gt; [38] "Evergreen International Airlines"        </span>
<span class="co">#&gt; [39] "ExpressJet Airlines"                     </span>
<span class="co">#&gt; [40] "Finnair"                                 </span>
<span class="co">#&gt; [41] "French Bee"                              </span>
<span class="co">#&gt; [42] "Frontier Airlines"                       </span>
<span class="co">#&gt; [43] "Hawaiian Airlines"                       </span>
<span class="co">#&gt; [44] "Hong Kong Airlines Limited"              </span>
<span class="co">#&gt; [45] "Horizon Air"                             </span>
<span class="co">#&gt; [46] "Iberia"                                  </span>
<span class="co">#&gt; [47] "Icelandair (Inactive)"                   </span>
<span class="co">#&gt; [48] "Icelandair EHF"                          </span>
<span class="co">#&gt; [49] "Independence Air"                        </span>
<span class="co">#&gt; [50] "Japan Airlines"                          </span>
<span class="co">#&gt; [51] "Jazz Aviation"                           </span>
<span class="co">#&gt; [52] "Jet Airways"                             </span>
<span class="co">#&gt; [53] "JetBlue Airways"                         </span>
<span class="co">#&gt; [54] "KLM Royal Dutch Airlines"                </span>
<span class="co">#&gt; [55] "Korean Air Lines"                        </span>
<span class="co">#&gt; [56] "LAN Peru"                                </span>
<span class="co">#&gt; [57] "Lufthansa German Airlines"               </span>
<span class="co">#&gt; [58] "Mesa Airlines"                           </span>
<span class="co">#&gt; [59] "Mesaba Airlines"                         </span>
<span class="co">#&gt; [60] "Mexicana Airlines"                       </span>
<span class="co">#&gt; [61] "Miami Air International"                 </span>
<span class="co">#&gt; [62] "Midwest Airlines"                        </span>
<span class="co">#&gt; [63] "Northwest Airlines"                      </span>
<span class="co">#&gt; [64] "Norwegian Air Shuttle ASA"               </span>
<span class="co">#&gt; [65] "Norwegian Air UK Ltd"                    </span>
<span class="co">#&gt; [66] "Pacific Aviation"                        </span>
<span class="co">#&gt; [67] "Philippine Airlines"                     </span>
<span class="co">#&gt; [68] "Qantas Airways"                          </span>
<span class="co">#&gt; [69] "Republic Airlines"                       </span>
<span class="co">#&gt; [70] "SAS Airlines"                            </span>
<span class="co">#&gt; [71] "Servisair"                               </span>
<span class="co">#&gt; [72] "Singapore Airlines"                      </span>
<span class="co">#&gt; [73] "SkyWest Airlines"                        </span>
<span class="co">#&gt; [74] "Southwest Airlines"                      </span>
<span class="co">#&gt; [75] "Spirit Airlines"                         </span>
<span class="co">#&gt; [76] "Sun Country Airlines"                    </span>
<span class="co">#&gt; [77] "Swiss International"                     </span>
<span class="co">#&gt; [78] "Swissport USA"                           </span>
<span class="co">#&gt; [79] "TACA International Airlines, S.A."       </span>
<span class="co">#&gt; [80] "TAP Air Portugal"                        </span>
<span class="co">#&gt; [81] "Thomas Cook Airlines"                    </span>
<span class="co">#&gt; [82] "Trego Dugan Aviation"                    </span>
<span class="co">#&gt; [83] "Turkish Airlines"                        </span>
<span class="co">#&gt; [84] "United Airlines"                         </span>
<span class="co">#&gt; [85] "United Airlines - Pre 07/01/2013"        </span>
<span class="co">#&gt; [86] "US Airways"                              </span>
<span class="co">#&gt; [87] "Virgin America"                          </span>
<span class="co">#&gt; [88] "Virgin Atlantic"                         </span>
<span class="co">#&gt; [89] "Volaris Airlines"                        </span>
<span class="co">#&gt; [90] "WestJet Airlines"                        </span>
<span class="co">#&gt; [91] "World Airways"                           </span>
<span class="co">#&gt; [92] "WOW Air"                                 </span>
<span class="co">#&gt; [93] "XL Airways France"                       </span>
<span class="co">#&gt; [94] "Xtra Airways"</span>
</pre></div>
<p>The main thing that immediately pops out of this list that United Airlines, the main carrier at SFO, listed twice as <code>United Airlines</code> and <code>United Airlines - Pre 07/01/2013</code>. I could not find any reference that explains the second label. If analyzing data before July 2013, I would relabel those cases as <code>United Airlines</code>. For this analysis we will focus on 2019, the most recent full year. Let’s start by filtering the data for 2019 flights:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">

<span class="kw">d19</span> <span class="op">&lt;-</span> <span class="kw">d</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">activity_period</span> <span class="op">&gt;=</span> <span class="fl">201901</span> <span class="op">&amp;</span> <span class="kw">activity_period</span> <span class="op">&lt;</span> <span class="fl">202001</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">published_airline</span>, <span class="kw">geo_summary</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(total = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">passenger_count</span>), .groups = <span class="st">"drop"</span>)
</pre></div>
<p>Before we summarize the data by airlines, let’s see the distribution of flights by geo type (domestic vs. international):</p>
<div class="sourceCode" id="cb11"><pre class="downlit">

<span class="kw">d19</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">geo_summary</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(total_geo = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">total</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span>(labels = <span class="op">~</span> <span class="kw">geo_summary</span>,
          values = <span class="op">~</span> <span class="kw">total_geo</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_pie</a></span>(hole = <span class="fl">0.6</span>)
</pre></div>
<div id="htmlwidget-9bd98a483315590c2971" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9bd98a483315590c2971">{"x":{"visdat":{"aa2eec5eba0":["function () ","plotlyVisDat"]},"cur_data":"aa2eec5eba0","attrs":{"aa2eec5eba0":{"labels":{},"values":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"pie","hole":0.6,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"labels":["Domestic","International"],"values":[42116019,15302555],"type":"pie","hole":0.6,"marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(255,255,255,1)"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>Close 75% of the air passenger traffic in SFO during 2019 were domestic. That is 42M passengers out of 57.4M passengers. Let’s use a treemap plot to see the distribution of passengers by airline and geo:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span>(data = <span class="kw">d19</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">geo_summary</span> <span class="op">==</span> <span class="st">"Domestic"</span>),
          labels = <span class="op">~</span> <span class="kw">published_airline</span>, 
          values = <span class="op">~</span> <span class="kw">total</span>,
          type = <span class="st">"treemap"</span>,
          parents=  <span class="op">~</span><span class="kw">geo_summary</span>,
          domain = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(row=<span class="fl">0</span>),
          name = <span class="st">"Domestic"</span>,
          textinfo=<span class="st">"label+value+percent parent"</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span>(data = <span class="kw">d19</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">geo_summary</span> <span class="op">==</span> <span class="st">"International"</span>),
            labels = <span class="op">~</span> <span class="kw">published_airline</span>, 
            values = <span class="op">~</span> <span class="kw">total</span>,
            type = <span class="st">"treemap"</span>,
            parents=  <span class="op">~</span><span class="kw">geo_summary</span>,
            domain = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(row=<span class="fl">1</span>),
            name = <span class="st">"International"</span>,
            textinfo=<span class="st">"label+value+percent parent"</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span>(title = <span class="st">"Passengers Distribution During 2019 by Geo"</span>,
      grid=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(columns=<span class="fl">1</span>, rows=<span class="fl">2</span>))
</pre></div>
<div id="htmlwidget-73be3e80ce4aa795f6a1" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-73be3e80ce4aa795f6a1">{"x":{"visdat":{"aa2e396688c7":["function () ","plotlyVisDat"],"aa2e7a9dde41":["function () ","data"]},"cur_data":"aa2e7a9dde41","attrs":{"aa2e396688c7":{"labels":{},"values":{},"parents":{},"domain":{"row":0},"textinfo":"label+value+percent parent","name":"Domestic","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"treemap"},"aa2e7a9dde41":{"labels":{},"values":{},"parents":{},"domain":{"row":1},"textinfo":"label+value+percent parent","name":"International","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"treemap","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Passengers Distribution During 2019 by Geo","grid":{"columns":1,"rows":2},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"labels":["Alaska Airlines","American Airlines","Delta Air Lines","Frontier Airlines","Hawaiian Airlines","JetBlue Airways","Southwest Airlines","Sun Country Airlines","United Airlines"],"values":[6453223,4173488,4529622,476731,366156,1455318,3250038,211427,21200016],"parents":["Domestic","Domestic","Domestic","Domestic","Domestic","Domestic","Domestic","Domestic","Domestic"],"domain":{"row":0},"textinfo":"label+value+percent parent","name":"Domestic","type":"treemap","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(255,255,255,1)"}},"frame":null},{"labels":["ABC Aerolineas S.A. de C.V. dba Interjet","Aer Lingus","Aeromexico","Air Canada","Air China","Air France","Air India Limited","Air Italy S.P.A","Air New Zealand","Air Pacific Limited dba Fiji Airways","Alaska Airlines","All Nippon Airways","Asiana Airlines","British Airways","Cathay Pacific","China Airlines","China Eastern","China Southern","COPA Airlines, Inc.","El Al Israel Airlines LTD.","Emirates","EVA Airways","Finnair","French Bee","Hong Kong Airlines Limited","Iberia","Icelandair EHF","Japan Airlines","KLM Royal Dutch Airlines","Korean Air Lines","Lufthansa German Airlines","Norwegian Air Shuttle ASA","Norwegian Air UK Ltd","Philippine Airlines","Qantas Airways","SAS Airlines","Singapore Airlines","Swiss International","TACA International Airlines, S.A.","TAP Air Portugal","Thomas Cook Airlines","Turkish Airlines","United Airlines","Virgin Atlantic","Volaris Airlines","WestJet Airlines","XL Airways France"],"values":[120633,179430,339192,1123314,257998,359462,194040,36267,163058,65689,222654,158248,193476,437051,529929,226404,238138,219079,186505,36022,317696,567890,54407,134331,86997,102168,69829,154747,311490,334020,493851,19575,116319,307436,271237,147577,357093,214657,180559,68876,31750,231731,4979794,289573,3726,146250,22387],"parents":["International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International","International"],"domain":{"row":1},"textinfo":"label+value+percent parent","name":"International","type":"treemap","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,255,255,1)"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="air-traffic-summary" class="section level3">
<h3 class="hasAnchor">
<a href="#air-traffic-summary" class="anchor"></a>Air Traffic Summary</h3>
<p>Last but not least, it would be interesting to leverage the different categorical variables to create a summary plot with Sankey. We will use the <code>sankey_ly</code> function, a <strong>plotly</strong> wrapper that automatically creates the data transformation and a Sankey plot with <strong>plotly</strong>. We will rank the top 20 airlines during 2019 and plot the passengers’ distribution by the airline, travel type (domestic or international), travel geo, activity type (deplaned, enplaned, and transit), and fare type (low or other):</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">rank</span> <span class="op">&lt;-</span> <span class="kw">sfo_passengers</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">activity_period</span> <span class="op">&gt;=</span> <span class="fl">201901</span> <span class="op">&amp;</span> <span class="kw">activity_period</span> <span class="op">&lt;=</span> <span class="fl">201912</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">operating_airline</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(total = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">passenger_count</span>), .groups = <span class="st">"drop"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="op">-</span><span class="kw">total</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span>(n = <span class="fl">20</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">operating_airline</span>)


<span class="kw">sfo_passengers</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">activity_period</span> <span class="op">&gt;=</span> <span class="fl">201901</span> <span class="op">&amp;</span> <span class="kw">activity_period</span> <span class="op">&lt;=</span> <span class="fl">201912</span>, <span class="kw">operating_airline</span> <span class="op">%in%</span> <span class="kw">rank</span><span class="op">$</span><span class="kw">operating_airline</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">operating_airline</span>, <span class="kw">geo_summary</span>, <span class="kw">geo_region</span>, <span class="kw">activity_type_code</span>, 
           <span class="kw">price_category_code</span>, <span class="kw">terminal</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(total = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">passenger_count</span>), .groups = <span class="st">"drop"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/sankey_ly.html">sankey_ly</a></span>(cat_cols = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"operating_airline"</span>,<span class="st">"geo_summary"</span>,
                      <span class="st">"geo_region"</span>, <span class="st">"activity_type_code"</span>,
                      <span class="st">"price_category_code"</span>),
          num_col = <span class="st">"total"</span>,
          title = <span class="st">"SFO Air Traffic Passenger Dist. During 2019"</span>)
</pre></div>
<div id="htmlwidget-e41996e1bbea63ba4f54" style="width:768px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e41996e1bbea63ba4f54">{"x":{"visdat":{"aa2e1d6fe95f":["function () ","plotlyVisDat"]},"cur_data":"aa2e1d6fe95f","attrs":{"aa2e1d6fe95f":{"orientation":"h","valueformat":".0f","node":{"label":["Aeromexico","Air Canada","Air France","Alaska Airlines","American Airlines","British Airways","Cathay Pacific","Delta Air Lines","Emirates","EVA Airways","Frontier Airlines","Hawaiian Airlines","Horizon Air","JetBlue Airways","Korean Air Lines","Lufthansa German Airlines","Singapore Airlines","SkyWest Airlines","Southwest Airlines","United Airlines","International","Domestic","Mexico","Canada","Europe","US","Asia","Middle East","Australia / Oceania","Deplaned","Enplaned","Thru / Transit","Other","Low Fare"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,1,2,3,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,17,18,19,19,21,20,20,20,20,20,20,26,26,26,28,28,23,23,23,24,24,22,22,22,27,27,25,25,25,29,29,30,30,31,31],"target":[20,20,20,21,20,21,20,20,21,20,20,21,21,21,21,20,20,20,21,20,21,21,20,25,26,28,23,24,22,27,29,30,31,29,30,29,30,31,29,30,29,30,31,29,30,29,30,31,33,32,33,32,33,32],"value":[339192,922414,359462,5671307,222654,3918421,437051,529929,4431211,317696,567890,476731,366156,324901,1455318,334020,493851,357093,4074547,92113,3250038,17641210,4887681,41609840,3814102,371563,1572388,2444497,1157068,501428,1932967,1880361,774,188886,182677,782360,789972,56,1228156,1216341,575136,581929,3,258537,242891,20736760,20866051,7029,2596824,23105978,2584344,23175878,919,6943]},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"sankey"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"SFO Air Traffic Passenger Dist. During 2019","hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"orientation":"h","valueformat":".0f","node":{"label":["Aeromexico","Air Canada","Air France","Alaska Airlines","American Airlines","British Airways","Cathay Pacific","Delta Air Lines","Emirates","EVA Airways","Frontier Airlines","Hawaiian Airlines","Horizon Air","JetBlue Airways","Korean Air Lines","Lufthansa German Airlines","Singapore Airlines","SkyWest Airlines","Southwest Airlines","United Airlines","International","Domestic","Mexico","Canada","Europe","US","Asia","Middle East","Australia / Oceania","Deplaned","Enplaned","Thru / Transit","Other","Low Fare"],"pad":15,"thickness":30,"line":{"color":"black","width":0.5}},"link":{"source":[0,1,2,3,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,17,18,19,19,21,20,20,20,20,20,20,26,26,26,28,28,23,23,23,24,24,22,22,22,27,27,25,25,25,29,29,30,30,31,31],"target":[20,20,20,21,20,21,20,20,21,20,20,21,21,21,21,20,20,20,21,20,21,21,20,25,26,28,23,24,22,27,29,30,31,29,30,29,30,31,29,30,29,30,31,29,30,29,30,31,33,32,33,32,33,32],"value":[339192,922414,359462,5671307,222654,3918421,437051,529929,4431211,317696,567890,476731,366156,324901,1455318,334020,493851,357093,4074547,92113,3250038,17641210,4887681,41609840,3814102,371563,1572388,2444497,1157068,501428,1932967,1880361,774,188886,182677,782360,789972,56,1228156,1216341,575136,581929,3,258537,242891,20736760,20866051,7029,2596824,23105978,2584344,23175878,919,6943]},"type":"sankey","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rami Krispin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
